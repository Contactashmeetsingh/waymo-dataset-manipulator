import numpy as np
import networkx as nx
from build_graph import G  # Reuse the graph you built

# --- Adjacency Matrix ---
A = nx.to_numpy_array(G)
print("Adjacency Matrix (A):")
print(A)

# --- Degree Matrix ---
D = np.diag(np.sum(A, axis=1))
print("\nDegree Matrix (D):")
print(D)

# --- Laplacian Matrix ---
L = D - A
print("\nGraph Laplacian (L):")
print(L)

# --- Spectral Properties (structure / stability indicators) ---
eigenvalues = np.linalg.eigvals(L)
print("\nEigenvalues of Laplacian (structural stability):")
print(np.round(np.sort(eigenvalues), 4))

# --- Optional: compute clustering coefficient (interaction density) ---
clustering = nx.average_clustering(G)
print(f"\nAverage Clustering Coefficient: {clustering:.3f}")

# --- Optional: compute average path length (connectivity) ---
if nx.is_connected(G):
    apl = nx.average_shortest_path_length(G)
    print(f"Average Path Length: {apl:.3f}")
else:
    print(" Graph is not fully connected; multiple traffic clusters detected.")


# ✅ Positions loaded: (11648,) (11648,)
# ✅ Velocities loaded: (11648,) (11648,)
# ✅ Example speeds: [2.08454575 2.2525071  2.28928934 2.17822346 2.23756785 2.24973506
#  2.37513235 2.16290788 2.35760458 2.38841613]
# ✅ Saved graph as graph_representation_improved.png
# Adjacency Matrix (A):
# [[ 0.          2.01716781  4.03772096  5.98818823  7.99117252 10.00716031
#   12.15854218 14.10268645  0.          0.          0.          0.
#    0.          0.          0.          0.          0.          0.
#    0.          0.        ]
#  [ 2.01716781  0.          2.02073736  3.97108414  5.97403814  7.99001074
#   10.14137462 12.08551874 14.24536025  0.          0.          0.
#    0.          0.          0.          0.          0.          0.
#    0.          0.        ]
#  [ 4.03772096  2.02073736  0.          1.95052637  3.95353723  5.96955162
#    8.12107199 10.06523972 12.22529841 14.39441255  0.          0.
#    0.          0.          0.          0.          0.          0.
#    0.          0.        ]
#  [ 5.98818823  3.97108414  1.95052637  0.          2.00301096  4.0190253
#    6.1705678   8.11473588 10.27486374 12.44400669  0.          0.
#    0.          0.          0.          0.          0.          0.
#    0.          0.        ]
#  [ 7.99117252  5.97403814  3.95353723  2.00301096  0.          2.0160153
#    4.16760849  6.11176941  8.27200352 10.44117887  0.          0.
#    0.          0.          0.          0.          0.          0.
#    0.          0.        ]
#  [10.00716031  7.99001074  5.96955162  4.0190253   2.0160153   0.
#    2.15169895  4.09581383  6.25618968  8.42538734  0.          0.
#    0.          0.          0.          0.          0.          0.
#    0.          0.        ]
#  [12.15854218 10.14137462  8.12107199  6.1705678   4.16760849  2.15169895
#    0.          1.94416826  4.1044973   6.27369624  0.          0.
#    0.          0.          0.          0.          0.          0.
#    0.          0.        ]
#  [14.10268645 12.08551874 10.06523972  8.11473588  6.11176941  4.09581383
#    1.94416826  0.          2.16065445  4.32977921  0.          0.
#    0.          0.          0.          0.          0.          0.
#    0.          0.        ]
#  [ 0.         14.24536025 12.22529841 10.27486374  8.27200352  6.25618968
#    4.1044973   2.16065445  0.          2.16919898  0.          0.
#    0.          0.          0.          0.          0.          0.
#    0.          0.        ]
#  [ 0.          0.         14.39441255 12.44400669 10.44117887  8.42538734
#    6.27369624  4.32977921  2.16919898  0.          0.          0.
#    0.          0.          0.          0.          0.          0.
#    0.          0.        ]
#  [ 0.          0.          0.          0.          0.          0.
#    0.          0.          0.          0.          0.          0.19473586
#    0.49860445  0.68671771  0.99055781  1.25532218  1.5746884   1.95240381
#    2.30890649  2.67448997]
#  [ 0.          0.          0.          0.          0.          0.
#    0.          0.          0.          0.          0.19473586  0.
#    0.30512592  0.49385444  0.797362    1.06165112  1.38028675  1.7582299
#    2.11453027  2.48040035]
#  [ 0.          0.          0.          0.          0.          0.
#    0.          0.          0.          0.          0.49860445  0.30512592
#    0.          0.18886281  0.4922426   0.75674007  1.076505    1.45389306
#    1.81060102  2.17591841]
#  [ 0.          0.          0.          0.          0.          0.
#    0.          0.          0.          0.          0.68671771  0.49385444
#    0.18886281  0.          0.30386504  0.56895079  0.89036087  1.26677993
#    1.62391141  1.98847794]
#  [ 0.          0.          0.          0.          0.          0.
#    0.          0.          0.          0.          0.99055781  0.797362
#    0.4922426   0.30386504  0.          0.2654152   0.58860156  0.9635128
#    1.32093851  1.68486103]
#  [ 0.          0.          0.          0.          0.          0.
#    0.          0.          0.          0.          1.25532218  1.06165112
#    0.75674007  0.56895079  0.2654152   0.          0.32460826  0.69810018
#    1.05557018  1.41953878]
#  [ 0.          0.          0.          0.          0.          0.
#    0.          0.          0.          0.          1.5746884   1.38028675
#    1.076505    0.89036087  0.58860156  0.32460826  0.          0.37892414
#    0.73424523  1.10086887]
#  [ 0.          0.          0.          0.          0.          0.
#    0.          0.          0.          0.          1.95240381  1.7582299
#    1.45389306  1.26677993  0.9635128   0.69810018  0.37892414  0.
#    0.3577286   0.7222328 ]
#  [ 0.          0.          0.          0.          0.          0.
#    0.          0.          0.          0.          2.30890649  2.11453027
#    1.81060102  1.62391141  1.32093851  1.05557018  0.73424523  0.3577286
#    0.          0.36904919]
#  [ 0.          0.          0.          0.          0.          0.
#    0.          0.          0.          0.          2.67448997  2.48040035
#    2.17591841  1.98847794  1.68486103  1.41953878  1.10086887  0.7222328
#    0.36904919  0.        ]]

# Degree Matrix (D):
# [[56.30263845  0.          0.          0.          0.          0.
#    0.          0.          0.          0.          0.          0.
#    0.          0.          0.          0.          0.          0.
#    0.          0.        ]
#  [ 0.         58.44529179  0.          0.          0.          0.
#    0.          0.          0.          0.          0.          0.
#    0.          0.          0.          0.          0.          0.
#    0.          0.        ]
#  [ 0.          0.         62.73809621  0.          0.          0.
#    0.          0.          0.          0.          0.          0.
#    0.          0.          0.          0.          0.          0.
#    0.          0.        ]
#  [ 0.          0.          0.         54.93600909  0.          0.
#    0.          0.          0.          0.          0.          0.
#    0.          0.          0.          0.          0.          0.
#    0.          0.        ]
#  [ 0.          0.          0.          0.         50.93033444  0.
#    0.          0.          0.          0.          0.          0.
#    0.          0.          0.          0.          0.          0.
#    0.          0.        ]
#  [ 0.          0.          0.          0.          0.         50.93085306
#    0.          0.          0.          0.          0.          0.
#    0.          0.          0.          0.          0.          0.
#    0.          0.        ]
#  [ 0.          0.          0.          0.          0.          0.
#   55.23322582  0.          0.          0.          0.          0.
#    0.          0.          0.          0.          0.          0.
#    0.          0.        ]
#  [ 0.          0.          0.          0.          0.          0.
#    0.         63.01036596  0.          0.          0.          0.
#    0.          0.          0.          0.          0.          0.
#    0.          0.        ]
#  [ 0.          0.          0.          0.          0.          0.
#    0.          0.         59.70806633  0.          0.          0.
#    0.          0.          0.          0.          0.          0.
#    0.          0.        ]
#  [ 0.          0.          0.          0.          0.          0.
#    0.          0.          0.         58.47765986  0.          0.
#    0.          0.          0.          0.          0.          0.
#    0.          0.        ]
#  [ 0.          0.          0.          0.          0.          0.
#    0.          0.          0.          0.         12.1364267   0.
#    0.          0.          0.          0.          0.          0.
#    0.          0.        ]
#  [ 0.          0.          0.          0.          0.          0.
#    0.          0.          0.          0.          0.         10.58617661
#    0.          0.          0.          0.          0.          0.
#    0.          0.        ]
#  [ 0.          0.          0.          0.          0.          0.
#    0.          0.          0.          0.          0.          0.
#    8.75849335  0.          0.          0.          0.          0.
#    0.          0.        ]
#  [ 0.          0.          0.          0.          0.          0.
#    0.          0.          0.          0.          0.          0.
#    0.          8.01178093  0.          0.          0.          0.
#    0.          0.        ]
#  [ 0.          0.          0.          0.          0.          0.
#    0.          0.          0.          0.          0.          0.
#    0.          0.          7.40735656  0.          0.          0.
#    0.          0.        ]
#  [ 0.          0.          0.          0.          0.          0.
#    0.          0.          0.          0.          0.          0.
#    0.          0.          0.          7.40589676  0.          0.
#    0.          0.        ]
#  [ 0.          0.          0.          0.          0.          0.
#    0.          0.          0.          0.          0.          0.
#    0.          0.          0.          0.          8.04908908  0.
#    0.          0.        ]
#  [ 0.          0.          0.          0.          0.          0.
#    0.          0.          0.          0.          0.          0.
#    0.          0.          0.          0.          0.          9.55180521
#    0.          0.        ]
#  [ 0.          0.          0.          0.          0.          0.
#    0.          0.          0.          0.          0.          0.
#    0.          0.          0.          0.          0.          0.
#   11.6954809   0.        ]
#  [ 0.          0.          0.          0.          0.          0.
#    0.          0.          0.          0.          0.          0.
#    0.          0.          0.          0.          0.          0.
#    0.         14.61583733]]

# Graph Laplacian (L):
# [[ 56.30263845  -2.01716781  -4.03772096  -5.98818823  -7.99117252
#   -10.00716031 -12.15854218 -14.10268645   0.           0.
#     0.           0.           0.           0.           0.
#     0.           0.           0.           0.           0.        ]
#  [ -2.01716781  58.44529179  -2.02073736  -3.97108414  -5.97403814
#    -7.99001074 -10.14137462 -12.08551874 -14.24536025   0.
#     0.           0.           0.           0.           0.
#     0.           0.           0.           0.           0.        ]
#  [ -4.03772096  -2.02073736  62.73809621  -1.95052637  -3.95353723
#    -5.96955162  -8.12107199 -10.06523972 -12.22529841 -14.39441255
#     0.           0.           0.           0.           0.
#     0.           0.           0.           0.           0.        ]
#  [ -5.98818823  -3.97108414  -1.95052637  54.93600909  -2.00301096
#    -4.0190253   -6.1705678   -8.11473588 -10.27486374 -12.44400669
#     0.           0.           0.           0.           0.
#     0.           0.           0.           0.           0.        ]
#  [ -7.99117252  -5.97403814  -3.95353723  -2.00301096  50.93033444
#    -2.0160153   -4.16760849  -6.11176941  -8.27200352 -10.44117887
#     0.           0.           0.           0.           0.
#     0.           0.           0.           0.           0.        ]
#  [-10.00716031  -7.99001074  -5.96955162  -4.0190253   -2.0160153
#    50.93085306  -2.15169895  -4.09581383  -6.25618968  -8.42538734
#     0.           0.           0.           0.           0.
#     0.           0.           0.           0.           0.        ]
#  [-12.15854218 -10.14137462  -8.12107199  -6.1705678   -4.16760849
#    -2.15169895  55.23322582  -1.94416826  -4.1044973   -6.27369624
#     0.           0.           0.           0.           0.
#     0.           0.           0.           0.           0.        ]
#  [-14.10268645 -12.08551874 -10.06523972  -8.11473588  -6.11176941
#    -4.09581383  -1.94416826  63.01036596  -2.16065445  -4.32977921
#     0.           0.           0.           0.           0.
#     0.           0.           0.           0.           0.        ]
#  [  0.         -14.24536025 -12.22529841 -10.27486374  -8.27200352
#    -6.25618968  -4.1044973   -2.16065445  59.70806633  -2.16919898
#     0.           0.           0.           0.           0.
#     0.           0.           0.           0.           0.        ]
#  [  0.           0.         -14.39441255 -12.44400669 -10.44117887
#    -8.42538734  -6.27369624  -4.32977921  -2.16919898  58.47765986
#     0.           0.           0.           0.           0.
#     0.           0.           0.           0.           0.        ]
#  [  0.           0.           0.           0.           0.
#     0.           0.           0.           0.           0.
#    12.1364267   -0.19473586  -0.49860445  -0.68671771  -0.99055781
#    -1.25532218  -1.5746884   -1.95240381  -2.30890649  -2.67448997]
#  [  0.           0.           0.           0.           0.
#     0.           0.           0.           0.           0.
#    -0.19473586  10.58617661  -0.30512592  -0.49385444  -0.797362
#    -1.06165112  -1.38028675  -1.7582299   -2.11453027  -2.48040035]
#  [  0.           0.           0.           0.           0.
#     0.           0.           0.           0.           0.
#    -0.49860445  -0.30512592   8.75849335  -0.18886281  -0.4922426
#    -0.75674007  -1.076505    -1.45389306  -1.81060102  -2.17591841]
#  [  0.           0.           0.           0.           0.
#     0.           0.           0.           0.           0.
#    -0.68671771  -0.49385444  -0.18886281   8.01178093  -0.30386504
#    -0.56895079  -0.89036087  -1.26677993  -1.62391141  -1.98847794]
#  [  0.           0.           0.           0.           0.
#     0.           0.           0.           0.           0.
#    -0.99055781  -0.797362    -0.4922426   -0.30386504   7.40735656
#    -0.2654152   -0.58860156  -0.9635128   -1.32093851  -1.68486103]
#  [  0.           0.           0.           0.           0.
#     0.           0.           0.           0.           0.
#    -1.25532218  -1.06165112  -0.75674007  -0.56895079  -0.2654152
#     7.40589676  -0.32460826  -0.69810018  -1.05557018  -1.41953878]
#  [  0.           0.           0.           0.           0.
#     0.           0.           0.           0.           0.
#    -1.5746884   -1.38028675  -1.076505    -0.89036087  -0.58860156
#    -0.32460826   8.04908908  -0.37892414  -0.73424523  -1.10086887]
#  [  0.           0.           0.           0.           0.
#     0.           0.           0.           0.           0.
#    -1.95240381  -1.7582299   -1.45389306  -1.26677993  -0.9635128
#    -0.69810018  -0.37892414   9.55180521  -0.3577286   -0.7222328 ]
#  [  0.           0.           0.           0.           0.
#     0.           0.           0.           0.           0.
#    -2.30890649  -2.11453027  -1.81060102  -1.62391141  -1.32093851
#    -1.05557018  -0.73424523  -0.3577286   11.6954809   -0.36904919]
#  [  0.           0.           0.           0.           0.
#     0.           0.           0.           0.           0.
#    -2.67448997  -2.48040035  -2.17591841  -1.98847794  -1.68486103
#    -1.41953878  -1.10086887  -0.7222328   -0.36904919  14.61583733]]

# Eigenvalues of Laplacian (structural stability):
# [ 0.      0.      7.6143  8.0327  8.4807  9.0811 10.0851 11.0462 11.973
#  13.6254 18.2797 48.7718 51.0507 52.5065 55.0794 59.0679 62.8744 68.8887
#  83.8257 88.6474]

# Average Clustering Coefficient: 0.971
#  Graph is not fully connected; multiple traffic clusters detected.